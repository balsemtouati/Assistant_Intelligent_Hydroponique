<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HydroCare | DÃ©tection Maladies</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/dashborad.css" />
  <link rel="stylesheet" href="css/detection.css" />
  <!-- Base URL du backend de dÃ©tection des maladies (FastAPI api.py sur port 8003) -->
  <!-- Dans detection.html -->
  <script>window.HC_API_BASE = "http://127.0.0.1:8003";</script>
  <script defer src="js/detection.js"></script>
</head>
<body class="dash-body">
  <div class="dash-layout">
    <!-- Sidebar (identique Ã  dashboard) -->
    <aside class="dash-sidebar" aria-label="Navigation tableau de bord">
      <div class="brand">
        <div class="brand-icon">ğŸŒ±</div>
        <span class="brand-text">HydroCare</span>
      </div>
      <nav class="dash-nav">
        <ul>
          <li><a href="dashboard.html">ğŸ“Š Dashboard</a></li>
          <li><a href="contrats.html">ğŸ“„ Contrats</a></li>
          <li><a href="parametres.html">âš™ï¸ ParamÃ¨tres</a></li>
          <li><a href="chat.html">ğŸ’¬ Assistant</a></li>
          <li><a href="detection.html" class="active">ğŸ©º DÃ©tection</a></li>
        </ul>
      </nav>
      <button id="logoutBtn" class="logout-btn" aria-label="DÃ©connexion">
        <span class="logout-icon">â»</span>
        <span class="logout-text">DÃ©connexion</span>
      </button>
    </aside>

    <!-- Contenu principal -->
    <main class="dash-main" id="dashMain" tabindex="-1">
      <header class="dash-topbar">
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Afficher / masquer menu">
          <span class="toggle-bar"></span>
          <span class="toggle-bar"></span>
          <span class="toggle-bar"></span>
        </button>
        <h1 class="dash-title">DÃ©tection de Maladies</h1>
        <div class="user-badge" id="userBadge">
          <span class="user-avatar">ğŸ‘¤</span>
          <span class="user-name"></span>
        </div>
      </header>

      <section class="dash-content detection-content">
        <!-- En-tÃªte -->
        <div class="detection-header">
          <div class="detection-welcome">
            <h2>Diagnostic par Image</h2>
            <p>Prenez une photo d'une feuille pour analyser les maladies potentielles</p>
          </div>
          <button id="historyBtn" class="btn secondary" title="Voir l'historique des analyses">
            <span class="btn-icon">ğŸ“‹</span>
            Historique
          </button>
        </div>

        <!-- Zone principale de dÃ©tection -->
        <div class="detection-container">
          <!-- Zone de tÃ©lÃ©chargement -->
          <div class="upload-section">
            <div class="upload-card">
              <div class="upload-icon">ğŸ“¸</div>
              <h3>Analyser une feuille</h3>
              <p>TÃ©lÃ©chargez une photo claire d'une feuille pour dÃ©tecter les maladies</p>
              
              <div class="upload-zone" id="uploadZone">
                <input type="file" id="imageInput" accept="image/*" capture="camera" />
                <div class="upload-placeholder">
                  <span class="upload-icon-large">ğŸ–¼ï¸</span>
                  <p>Cliquez pour prendre une photo ou choisir une image</p>
                  <span class="upload-hint">Formats supportÃ©s: JPG, PNG, WebP</span>
                </div>
                <div class="upload-preview" id="uploadPreview"></div>
              </div>
              
              <button id="analyzeBtn" class="btn primary analyze-btn" disabled>
                <span class="btn-icon">ğŸ”</span>
                Analyser l'image
              </button>
            </div>
          </div>

          <!-- Zone de rÃ©sultats -->
          <div class="results-section">
            <div class="results-card">
              <h3>RÃ©sultats de l'analyse</h3>
              <div class="results-placeholder" id="resultsPlaceholder">
                <div class="placeholder-content">
                  <span class="placeholder-icon">ğŸŒ¿</span>
                  <p>Les rÃ©sultats d'analyse apparaÃ®tront ici</p>
                </div>
              </div>
              
              <div class="results-content" id="resultsContent" style="display: none;">
                <div class="diagnosis-header">
                  <span class="diagnosis-icon" id="diagnosisIcon">âœ…</span>
                  <span class="diagnosis-title" id="diagnosisTitle">Diagnostic</span>
                </div>
                
                <div class="disease-info">
                  <div class="confidence-level">
                    <span class="confidence-label">Confiance:</span>
                    <div class="confidence-bar">
                      <div class="confidence-fill" id="confidenceFill"></div>
                    </div>
                    <span class="confidence-value" id="confidenceValue">0%</span>
                  </div>
                  
                  <div class="disease-name" id="diseaseName">-</div>
                  <div class="disease-description" id="diseaseDescription"></div>
                </div>
                
                <div class="recommendations">
                  <h4>Recommandations</h4>
                  <div class="recommendations-list" id="recommendationsList"></div>
                </div>
                
                <div class="actions">
                  <button id="saveReportBtn" class="btn secondary">
                    <span class="btn-icon">ğŸ’¾</span>
                    Sauvegarder
                  </button>
                  <button id="shareBtn" class="btn secondary">
                    <span class="btn-icon">ğŸ“¤</span>
                    Partager
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section maladies courantes -->
        <div class="common-diseases">
          <h3>Maladies Courantes</h3>
          <div class="diseases-grid">
            <div class="disease-card">
              <div class="disease-icon">ğŸ‚</div>
              <h4>Mildiou</h4>
              <p>Taches brunes sur les feuilles, pourriture</p>
              <span class="disease-tag traitement">Traitement</span>
            </div>
            <div class="disease-card">
              <div class="disease-icon">ğŸŸ¡</div>
              <h4>OÃ¯dium</h4>
              <p>Poudre blanche sur les feuilles</p>
              <span class="disease-tag prevention">PrÃ©vention</span>
            </div>
            <div class="disease-card">
              <div class="disease-icon">ğŸŸ«</div>
              <h4>Pourriture racinaire</h4>
              <p>Racines brunes et molles</p>
              <span class="disease-tag urgence">Urgence</span>
            </div>
            <div class="disease-card">
              <div class="disease-icon">ğŸ›</div>
              <h4>Pucerons</h4>
              <p>Insectes verts sous les feuilles</p>
              <span class="disease-tag traitement">Traitement</span>
            </div>
          </div>
        </div>
      </section>

      <footer class="dash-footer">
        <div class="footer-content">
          <span>Â© <span id="yearDetection"></span> HydroCare â€¢ DÃ©tection intelligente des maladies</span>
        </div>
      </footer>
    </main>
  </div>

  <script>
    document.getElementById('yearDetection').textContent = new Date().getFullYear();
    
    // RÃ©cupÃ©ration du nom d'utilisateur
    const username = localStorage.getItem('hydrocare_user') || 'Utilisateur';
    document.getElementById('userBadge').querySelector('.user-name').textContent = username;
  </script>
</body>
</html>